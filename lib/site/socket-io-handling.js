// Generated by CoffeeScript 1.4.0
(function() {
  var io, socketIo;

  socketIo = require('socket.io');

  io = null;

  module.exports = function(server) {
    var lines;
    io = socketIo.listen(server);
    io.set("log level", 0);
    lines = [];
    return io.sockets.on("connection", function(socket) {
      socket.on("msg", function(data) {
        lines.push(data);
        if (lines.length > 100) {
          lines.splice(0, lines.length - 100);
        }
        return socket.broadcast.emit("msg", data);
      });
      socket.on("nick", function(data) {
        var oldNick;
        return oldNick = socket.get("nick", function() {
          return socket.set("nick", data.nick, function() {});
        });
      });
      return socket.on("lines", function(data) {
        return socket.emit("lines", {
          lines: lines
        });
      });
    });
  };

}).call(this);
