Feature "Registration" {
	As a visitor
	I should be able to register with my
	- email
	- company name
	- password
	So I can ???}

	Scenario "Register for the 1st time"
		Given "I'm a Visitor"
		When "I try to register"
		Then "It should succeed"
			& "I should get my details back"
			& "no passwords included"
			& "with a user ID"

	Scenario "Already registered"
		Given "I'm a registered User"
		When "I try to register again"
		Then "I should be remembered"
			& "get a 409 Conflict error"
	
	Scenario "Logged in"
		Given "I'm a registered User"
			& "I'm logged in"
		When "Someone tries to register"
		Then "S/he should get a 403 Forbidden error"

Feature "Fax data entry" {
	In order to create BODs
	As a Backoffice user
	I should see a Fax, so I can copy the data into a selected BOD skeleton}

	Scenario "Get the Fax as a task"
		Given "I'm a Backoffice user"
			& "a Fax has arrived"
		When "I ask for the next task"
		Then "I should get the same Fax image"
			& "a ProcessRFQ skeleton"
			& "a ProcessPO skeleton"
			& "which links to the Fax image"
		When "we have a look at the board"
		Then "we should see a Fax card in the Backoffice lane"

Feature "Submit RFQ" {
	In order to get prices for parts I want to buy
	As a Customer or Backoffice user
	I should be able to submit an RFQ to Sales}

	before-each-scenario: does [	register backoffice  register sales  login backoffice  login sales]

	Scenario "Backoffice submits an RFQ form which arrives to Sales"
		GIVEN "a Fax has arrived"
		WHEN "the Backoffice user asks for the next task"
		THEN "he gets empty forms"
		WHEN "he submits the ProcessRFQ form"
		THEN "he should get a confirmation"
		WHEN "we have a look at the board"
		THEN "we should see a ready RFQ card in the Backoffice lane"
		WHEN "a Sales man asks for the next task"
		THEN "he should get 1 ProcessSalesOrder"
			& "it has a PriceList"
			& "it has the same number of line items as the RFQ"
			& "each line item has CatalogReference"
			& "has the same Customer as in the RFQ"
		WHEN "we have a look at the board"
		THEN "we should see a WIP RFQ card in the Sales lane"

;	Scenario "RFQ is complete and valid"
;		Given ""

;	Scenario "Using RFQ template from Fax"
;		Given "a Fax has arrived"
;		When "the Backoffice user asks for the next task"

Feature "Map all RFQ items to inventory" {}

	before-each-scenario: does [	
		register backoffice  register customer  register sales
		login backoffice  login customer  login sales]

	Scenario "Map all RFQ items to inventory"
		GIVEN "a Fax has arrived"
			& "the Backoffice user asks for the next task"
			& "he submits the ProcessRFQ form"
			& "a Sales man asks for the next task"
		WHEN "he submits a full inventory mapping"
		THEN "he should get a confirmation"
		WHEN "we have a look at the board"
		THEN "we should see a ready inventory mapped RFQ card in the Sales lane"
		WHEN "a Sales man asks for the next task again"
		THEN "he should get 1 SyncSalesOrder"
			& "it has the same number of line items as the previous SalesOrder"
			& "it has fields for prices"
		WHEN "we have a look at the board"
		THEN "we should see a WIP quoting card in the Sales lane"
		WHEN "he submits the Quote"
		THEN "he should get a confirmation"
		WHEN "we have a look at the board"
		THEN "we should see a ready quoting card in the Sales lane"
		WHEN "the Backoffice user asks for the next task"
		THEN "he should get back a ProcessQuote"
		WITH "it has the same prices as the Quote"
			& "the addressee is the sender of the original RFQ"
		WHEN "we have a look at the board"
		THEN "we should see a WIP quote sending card in the Backoffice lane"
		WHEN "he submits the Quote"
		THEN "he should get a confirmation"
		WHEN "we have a look at the board"
		THEN "we should see a ready quote sending card in the Backoffice lane"

Feature "Map RFQ items to inventory partially" {}

	before-each-scenario: does [	
		register backoffice  register customer  register sales  register purchasing
		login backoffice  login customer  login sales  login purchasing]

	Scenario "Map RFQ items to inventory partially"
		GIVEN "a Fax has arrived"
			& "the Backoffice user asks for the next task"
			& "he submits the ProcessRFQ form"
			& "a Sales man asks for the next task"
		WHEN "he submits a partial inventory mapping"
		THEN "he should get a confirmation"
		WHEN "we have a look at the board"
		THEN "we should see a ready inventory mapped RFQ card in the Sales lane"
		WHEN "a Sales man asks for tasks again"
		THEN "he should not get any tasks yet"
		WHEN "a Purchasing user asks for tasks"
		THEN "the Purchasing user should get 1 SyncSalesOrder"
			& "it has a SalesOrder ID"
			& "it has fields for Supplier references"
			& "it has a Supplier list"
			& "it doesn't have a PriceList"
		WHEN "we have a look at the board"
		THEN "we should see a WIP mapping suppliers card in the Purchasing lane"

